<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>Tips n' tricks</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(4);
/*]]>*/
</script>
</head>
<body class="book" style="max-width:100%">
<div id="header">
<h1>Tips n' tricks</h1>
<span id="author">Broadcom Ltd</span><br />
<span id="email"><code>&lt;<a href="mailto:support@broadcom.com">support@broadcom.com</a>&gt;</code></span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>A grab-bag of assorted things that may be of assistance. No assurance
of completeness or validity is made for things here: <em>YMMV</em>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_device_tree_and_linux">1.  Device Tree and Linux</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">BOLT provides a Device Tree to Linux. That means the versions
of each are tied more closely together. You can&#8217;t just upgrade
one without considering the other. Note the actual Device Tree
passed into Linux and track it. Diffing with an upgraded BOLT
will be handy if you have problems. The release notes are your
friend here as we specify which kernel to use.</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
If after updating BOLT: Linux does not boot but you get a silent
hang, that generally means a Device Tree problem. Run "dt bolt;dt show"
for the previous (working) BOLT and the current one. The text
output should be diff&#8217;d to see what in Device Tree has changed.
</p>
</li>
<li>
<p>
Some Linux failures can be debugged by adding command line flags,
an example is show below, but please see the Linux documentation
for the precise commands for your kernel.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code> boot 192.168.0.42:vmlinuz-initrd-7445d0 "earlyprintk debug initcall_debug"</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
If after updating BOLT: Linux crashes near or at the userland
"init" process, or trying to mount an initrd, then the first suspect
is the DDR allocation setup in Device Tree. Either the DDR address
or size is wrong, or your <em>cma</em> nodes are wrong (for non-dynamic CMA
kernels.) Note that bogus cma nodes might fail early in the kernel
boot process, but with dynamic CMA you should not have that problem.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_changing_ddr_aka_mcb_at_runtime">2.  Changing DDR (aka MCB) at runtime</h2>
<div class="sectionbody">
<div class="paragraph"><p>Instead of a single shmoo
configuration we try to pack as many of them into the files in
shmoo/&lt;MEMC:PHY revision&gt;/mcb-{family}.c as possible, that means
you can override the default values for each BOLT build configuration.
To do so, choose option #2 in the FSBL menu to arrive at the shmoo
menu (after you&#8217;ve selected  a board.) If you have previously selected
a board and the FSBL menu is therefore bypassed, do this to return
to the FSBL menu:</p></div>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Hold down the <em>1</em> (one) numeric key so it autorepeats.
</p>
</li>
<li>
<p>
Press the reset button on the board (while keeping
 the <em>1</em> key held down')
</p>
</li>
</ol></div>
<div class="paragraph"><p>You might notice this option is in the FSBL menu:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>RESET + 1 = this menu</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This return to FSBL menu option is not available if the
SECURE_BOOT build option is set.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In the future we might choose another method of board detection
so the board selection menu may disappear. We intend to keep
the alternate shmoo selection (if possible) as its useful.</td>
</tr></table>
</div>
<div class="paragraph"><p>The shmoo menu allows you to enable debug or select another
DDR (<em>.mcb</em> file) configuration. If you select another
configuration  then it will apply to <em>all</em> DDRs for the
current board. Below is an example of arriving at the
shmoo menu:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>RESET + 1 = this menu
RESET + 8 = bypass AVS
2)  shmoo menu after board menu


Select board type: [shmoo menu]

Select board type:
using board #j
MEMSYS-STD
SHMOO 01010000 BLD:8661 HW:hpf0_b1p3 V:1.1.0.0
MCB: FLEX

a)      1067MHz 4Gx16 32b
b)      1067MHz 4Gx8 32b
c)      800MHz  4Gx16 32b
d)      800MHz  4Gx8 32b
e)      933MHz  4Gx16 32b

0)      undo override
1)      exit
2)      debug on
shmoo:</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Only the primary MCBs (see the <em>memsys std</em> script command)
can be selected. Those referenced by <em>memsys alt</em> cannot.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_avs_on_off">3.  AVS on/off</h2>
<div class="sectionbody">
<div class="paragraph"><p>AVS can be disabled on a one-shot basis to bypass a
crash situation that is preventing the code from reaching
the Bolt prompt where it can be disabled permanently.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">AVS should never be disabled in final production
builds of BOLT.</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
Hold down the <em>8</em> (eight) numeric key so that
it autorepeats and then reset the board.  AVS will not be
reloaded on this boot.  Use the Bolt "setboard" command
(-noavs option) to disable it on all subsequent boots
until the issue is resolved.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_checklists_amp_misc">4.  Checklists &amp; misc</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Check your board! Pinmuxing differences and shmoo
can be different. If you have a DDR not listed in the
shmoo menu (above) then contact your FAE. Remember to
check your DDR sizes and change your config (*.cfg)
file to match it; i.e. the memory, region &amp; cma
Device Tree nodes for the <em>dt autogen</em> and <em>ddr</em> build
commands.
</p>
</li>
<li>
<p>
The newer BOLTs are bigger than the older ones (v0.5x) so
if you find upgrading BOLT via BOLT e.g. using TFTP fails, use
<em>flash0</em> as a parameter to the <em>flash</em> command instead of
<em>flash0.bolt</em>.
</p>
</li>
<li>
<p>
The build products will be in the objs/&lt;FAMILY&gt; directory and below.
<em>make family</em> will tell you what &lt;FAMILY&gt; is. As well as bolt-*.bin
there will be a bolt.map and bolt.asm, these are your friends
when things go wrong when you need to follow the memory allocations and
code generated.
</p>
</li>
<li>
<p>
dtc woes/fails to build:
Your PATH should be picking up x86 gcc to build dtc and not the
ARM gcc. Check your host x86 gcc version, not all may manage
to build dtc.
</p>
</li>
<li>
<p>
Don&#8217;t rely on anything in build/brcm.mk from version to version,
don&#8217;t expect it to work for you either.
</p>
</li>
<li>
<p>
Autogenerated stuff will always go in gen/&lt;FAMILY&gt; for code files
and common items such as dtc, script helpers and zlib. Linker
scripts end up in objs/&lt;FAMILY&gt;.
</p>
</li>
<li>
<p>
Its bad news to hand hack anything in gen/ as it will disappear
if the configuration changes. It also messes up us supporting you
if you go do that.
</p>
</li>
<li>
<p>
We don&#8217;t ship any BOLT file beginning with a dot (UNIX hidden file.) If
you see a dot file then its generated, or in thirdparty/.
</p>
</li>
<li>
<p>
make will also create memsys.bin, fsbl.bin &amp; ssbl.bin from bolt-*.bin.
 Note that these files contain ONLY what is in the associated BOLT
section (layout) i.e. excludes such things as avs, shmoo, bbl or bfw
sections.
</p>
</li>
<li>
<p>
If you want to wave makeflags (mset), cflags (cset) or both (gset), put
them in the config/*.cfg file for the chip, that way they are all in one place.
 We prefer to unify those flags, so use <em>gset</em> if at all possible.
</p>
</li>
<li>
<p>
For your production board copy over the cfg, dts &amp; rts files and start from
there. That way you can still build for a reference board for comparison.
Example:
</p>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>make <span style="color: #009900">FAMILY</span><span style="color: #990000">=</span>7445d0 <span style="color: #009900">CFG</span><span style="color: #990000">=</span>config/testing/ddrtests-<span style="color: #993399">7445</span><span style="color: #990000">.</span>cfg</tt></pre></div></div>
</li>
</ul></div>
<div class="paragraph"><p>NB: The cfg file specifies which dts &amp; rts file to use.</p></div>
<div class="ulist"><ul>
<li>
<p>
For production boards you don&#8217;t want the FSBL board selection menu,
so specify CFG_BOARDDEFAULT=N or only have ONE board in your config file.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Then again, you might have one product but variations such as DDR or
othe parameter. For multiple boards select them e.g. based on a pin
strap. That would of course mean having some code in FSBL instead
of the menu.</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
The DTS source file for the chip family *.cfg file is modified by
BOLT with runtime parameters. This is done either by the user
interface command <em>dt bolt</em> or just before Linux starts.
 Try <em>dt show</em>, <em>dt bolt</em> &amp; then another <em>dt show</em> to see the
differences.
</p>
</li>
<li>
<p>
The <em>dt show</em> command outputs in DTS file format so you can
screen-scrape it to create a new DTS source file.
</p>
</li>
<li>
<p>
If you wish to use the DT as-is without BOLT doing its
silent <em>dt bolt</em> before launching Linux, use the <em>dt off</em>
command.
</p>
</li>
</ul></div>
<div class="paragraph"><p>On booting Linux (or any othe app) you should see the
following line being output on the console:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>DT_OFF: bypass device tree modification</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
If you want Linux to have only 256Kb to play with for
example, do:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code> dt bolt
 dt add prop memory reg i 0x0 0x00 0x0 0x10000000
 dt off</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;now you can boot Linux&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The above modifies the Device Tree for all things,
then adjusts the <em>reg</em> property of the <em>memory</em>
node to 256Kb. The last prevents BOLT from
putting the old value back as it prevents the
silent <em>dt bolt</em> before booting Linux. Note the
use of 64 bit values to specify the memory
base address and size.</p></div>
<div class="paragraph"><p>All on one line to autostart Linux:</p></div>
<div class="listingblock">
<div class="content">
<pre><code> setenv -p STARTUP "dt bolt; dt add prop memory reg i 0x0 0x00 0x0 0x10000000; dt off; boot flash0.kernel:"</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Remember to fixup the memory <em>region@</em> and <em>cma-dev@</em> nodes
 for NEXUS if you  change the memory around. The cma is an
 allocation within the memory node you specify by
 the <em>region@</em> sub-node(s). This fixed CMA is marked
 to be removed once all configurations support dynamic CMA.
  If you have a newer kernel, ignore this.
</p>
</li>
<li>
<p>
If your Linux kernel uses dynamic CMA then the
<em>dt autogen -node memory</em> line can be removed.
</p>
</li>
<li>
<p>
Make sure you put <em>[end]</em> at the end of your config file
and don&#8217;t put any more text after it.
</p>
</li>
<li>
<p>
Note that the Device Tree memory setting are either identical
to the ddr, or a subset of them. The <em>ddr</em> entries in the
config file have a physical effect (SHMOO), those in
Device Tree are only to setup Linux.
</p>
</li>
<li>
<p>
Try to make sure any modifications you make to BOLT
also work on our reference boards. Its the key to
getting any issue you may have sorted out quickly:
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">MANY MORE PEOPLE IN BROADCOM IN VARIOUS TEAMS WITH
VARIED SPECIALITIES <strong>YOU MAY NEED</strong> HAVE REF BOARDS
THAN HAVE YOUR PRODUCTION OR DEVELOPMENT BOARD(S).</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
If you remove $(LIBGCC) from FSBL, or SSBL for that matter:
</p>
<div class="ulist"><ul>
<li>
<p>
DON&#8217;T do modulo (<em>%</em>) operations in FSBL. Just &#8658; DON&#8217;T! &#8656;
</p>
</li>
<li>
<p>
DON&#8217;T do divide operations in FSBL without applying some thought:
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p>Yes, you can see a divide in uart_init(), but that is
resolved at BUILD time, not runtime. copy_from_nand()
<em>dst += page_size/4</em> ends up as a simple shift etc.</p></div>
<div class="paragraph"><p>The toolchain chickens out of generating code and
relies on <em>arm eabi</em> calls in libgcc.a, which SSBL &amp;
and FSBL link in. Look at itoa() in FSBL which
has to approximate and work around calls to the (previously)
missing div &amp; mod - which was when we did not include
FSBL libgcc.a in earlier versions of BOLT.</p></div>
<div class="paragraph"><p>If you do ignore this advice then BOLT may even build
and boot but it won&#8217;t work as you expect.</p></div>
<div class="paragraph"><p><span class="big">You have been warned!</span></p></div>
<div class="ulist"><ul>
<li>
<p>
For debugging reasons you may not want the gen directory to be rebuilt.
To do this use: SCRIPT_ENG=<code>which true</code> when re-making.
e.g.
</p>
<div class="literalblock">
<div class="content">
<pre><code>make 7445d0 -j8  SCRIPT_ENG=`which true`</code></pre>
</div></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">You are on your own if you do this! Hand hacking the code in the
<em>gen/</em> directory is not supported by us.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bolt_and_arm">5.  BOLT and ARM</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Buy a good book on ARM assembly if haven&#8217;t already. Join
 at <a href="http://www.arm.com">http://www.arm.com</a> for online documentation.
</p>
</li>
<li>
<p>
With ARM, we have a internal static ram memory to run FSBL in.
 For 7445a0 its 64k. FSBL is limited to about 32K as the other
32K is taken by the stack growing down and things loaded
in there e.g. MCB (shmoo) &amp; AVS data. The board data there persists
so be careful how you use the SRAM in BOLT as you might wipe
important information. Once Linux boots, feel free to nuke it.
 UPDATE: We&#8217;ve moved the FSBL info into DDR (SSBL_BOARDINFO),
you are now free to use the sram, but be warned that on FSBL exit
(to SSBL) we wipe the sram.
</p>
</li>
<li>
<p>
The pagetables have a 1:1 virtual to physical mapping - which
we do need for cached memory as the MMU must be on for that
in ARM. Without MMU its uncached and still a flat memory model.
 Note that for "config UNCACHED on" BOLT does not disable the
MMU, but only marks all DDR page mappings as uncached.
</p>
</li>
<li>
<p>
The pagetables normally use 1Mb <em>SECTION</em> sized entries, except
for the first entry which now has a 2nd level page table with 4k
entries. This is done so we can unmap the very first 4k of ddr
to use as a NULL pointer trap. So DON&#8217;T peek or poke the
first 4k as you will get an exception. Its handy for debugging
and you can wire in the mechanism to reboot on such failures.
</p>
</li>
<li>
<p>
Note that when the MMU is on (normal cached or uncached builds)
unaligned memory accesses are allowed. If the MMU is turned off
then unaligned access will cause an exception. You may experience
problems using SPI flash, USB or and possibly areas of BOLT
in this case, or when using uncached (KUMALLOC) memory
directly.
</p>
</li>
</ul></div>
<div class="paragraph"><p><span class="line-through">When you boot up you will see something like this:</span></p></div>
<div class="paragraph"><p><span class="line-through">PTE RANGE 00000000 - C0000000</span></p></div>
<div class="paragraph"><p><span class="line-through">This is the page table range.</span></p></div>
<div class="ulist"><ul>
<li>
<p>
If running with the MMU enabled then a read or write outside
the MMU page table description of memory is bad news, you&#8217;ll
get either an exception or a chip reset.
</p>
</li>
<li>
<p>
The pagetable default is for 1Mb or <em>section</em> per entry,
not 4Kb. See ARM MMU documentation for more info. See
the config/layout*.cfg file for your chip on how the
BOLT binary is partitioned (nothing to do with the <em>show devices</em>
command which shows total flash partitions) and
where the page table base (SSBL_PAGE_TABLE) is located
in memory.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_flash_partitions">6.  Flash partitions</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
To use a traditional fixed flash map, create your flash map/partition
 layout and then specify it to the <em>mapselect</em> command in your config file,
 example config file snippet:
</p>
</li>
<li>
<p>
This is a family-$(FAMILY).cfg file, e.g. config/family-7445a0.cfg
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code> [version 1.7]
 # Flash map exists just after the [version] but before
 # the [config] heading.
 [map superbox]
 map superbox bolt    1Mb     CS0
 map superbox macadr  64Kb    CS0
 map superbox nvram   64Kb    CS0
 map superbox kernel  4Mb     CS0
 map superbox devtree 64Kb    CS0
 map superbox splash  512Kb   CS0
 #
 map superbox kernel  1024Mb  CS1
 map superbox rootfs  1024Mb  CS1
 map superbox app     2048Mb  CS1
 ...
 ...
 ...
 # flash map selection
 # mapselect STB // unselected default layout
  mapselect superbox
 ...
 ...
 ...
 [end]</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_alternate_toolchains">7.  Alternate toolchains</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
We now can support alternate ARM toolchains. Note that you are responsible
 for the limitations of such toolchains, e.g. missing headers BOLT needs,
 or weird configurations. Here is an example of setting up and building with
 such a toolchain:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt> make toolfind <span style="color: #009900">CROSS</span><span style="color: #990000">=</span>arm-eabi- <span style="color: #009900">ALT_TOOL</span><span style="color: #990000">=~</span>/arm-eabi-<span style="color: #993399">4.7</span>/bin

 <span style="font-style: italic"><span style="color: #9A1900"># cat toolpath</span></span>
 PATH<span style="color: #990000">:=</span>/home/user/arm-eabi-<span style="color: #993399">4.7</span>/bin<span style="color: #990000">:</span><span style="color: #009900">$(PATH)</span>
 CROSS<span style="color: #990000">:=</span>arm-eabi-

 <span style="font-style: italic"><span style="color: #9A1900"># make with minimal (-W) error checking:</span></span>
 make 7445d0 <span style="color: #009900">USTRICT</span><span style="color: #990000">=</span></tt></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_tftp_options">8.  TFTP options</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
User has an option to enable TFTP blksize option negotiation by setting
the following environment variables:
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">NET_TFTP_AUTO_BLKSIZE</p></td>
<td align="left" valign="top"><p class="table">Set to 1 to enable blksize option negotiation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">NET_TFTP_BLKSIZE</p></td>
<td align="left" valign="top"><p class="table">Set the BLKSIZE value to be used in negotiation</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>By default, NET_TFTP_AUTO_BLKSIZE is not set and 512 bytes is used as the
TFTP block size.  In order to improve the performance for TFTP, user
can enable the blksize negotiation option with larger block size.
You will also have to check that your TFTP server supports RFC 2348 option
negotiation feature.</p></div>
<div class="paragraph"><p>The expected range for NET_TFTP_BLKSIZE is 512 - 16384 bytes.  The max
value of 16384 is determined by the constant TFTP_MAX_BLOCKSIZE defined in
BOLT code.</p></div>
<div class="paragraph"><p>If NET_TFTP_AUTO_BLKSIZE is set, but NET_TFTP_BLKSIZE is not defined
by user, then TFTP_MAX_BLOCKSIZE constant will be used in automatic block
size negotiation.  Otherwise, the value set in NET_TFTP_BLKSIZE shall be
used.</p></div>
<div class="paragraph"><p>Based on experience testing with 7445d0 and with tftpd-hpa TFTP server on
Ubuntu 12.04, there is a limitation on the blksize one can select. The
exact reason for this limitation is TBD.  But one value that works (other
than 512 bytes) is 1468 bytes.  This value works because it is the
smallest MTU on the network (Ethernet MTU size is 1500) minus 32 bytes
(20 bytes for IP, 8 for UDP, and 4 for TFTP).</p></div>
<div class="paragraph"><p>To find out whether your TFTP server support RFC 2348, check the manpage
and look for --blocksize option.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_copyright_info">9. Appendix: Copyright Info</h2>
<div class="sectionbody">
<div class="paragraph"><p>Copyright &#169; 2016, Broadcom Ltd.
All Rights Reserved.
Confidential Property of Broadcom Ltd.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2017-04-07 11:39:42 PDT
</div>
</div>
</body>
</html>
